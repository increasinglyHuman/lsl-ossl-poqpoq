{
  "type": "script",
  "uuid": "2d4cb806-cbac-4784-9566-83fed640d964",
  "name": "2d4cb806-cbac-4784-9566-83fed640d964_script",
  "description": "",
  "source": "string          pEmail;\ninteger         pTotal_number           = 0;\ninteger         i                       = 0;\ninteger         pCurrentSlide           = 0;\ninteger         pSlideCount             = 0;\ninteger         dialog_channel2;\ninteger         reset_channel           = 17;\ninteger         pActiveQuestion         = 0;\ninteger         gSuccessInt             = 0;\ninteger         gMinPerc                = 0;\ninteger         gQueryCount             = 0;\ninteger         g_iLine;\ninteger         pL1;\ninteger         pL2;\nfloat           gScore;\nlist            types                  = [INVENTORY_OBJECT,INVENTORY_TEXTURE];\nlist            pAccessList            = [];\nlist            pAwardsList            = [];\nlist            gQueryList             = [];\nlist            gAnswerList            = [];\nlist            gOneCard;\nlist            g_lTempLines;\nkey             pLastId;\nkey             pActiveId;\nkey             g_kQuery;\nstring          gMessage;\nstring          gSuccess                = \"\";\nstring          gFailure                = \"\";\nstring          tQuestion;\nstring          gCorrectAnswer;\nstring          gsCardOneName           = \"exam_config\";\nstring          g_sNoteCardName;\nstring          qName;\n\ninteger random_integer( integer min, integer max )\n{\n  return min + (integer)( llFrand( max - min + 1 ) );\n}\n\nlist ListItemDelete(list mylist,string element_old) {\n    integer placeinlist     = llListFindList(mylist, [element_old]);\n    if (placeinlist != -1)\n        return llDeleteSubList(mylist, placeinlist, placeinlist);\n    return mylist;\n}\n\ngetNextQuestion()\n{\n    //llSay(0, \"42\");\n    string tLineText        = llList2String(gOneCard,(pActiveQuestion+7));\n    string comm             = left(tLineText, \":\");\n    string tQA              = right(tLineText, \":\");\n    tQuestion               = left(tQA, \":\");\n    tQA                     = right(tQA, \":\"); // all the answers\n    list tAnswerList        = [];\n    if (tQA != \"\")\n    {\n        integer tAnswerIter;\n        for (tAnswerIter = 0; tAnswerIter< 5; ++tAnswerIter)\n        {\n            string tA1                  = left(tQA, \":\");\n            string tSplat               = llGetSubString(tA1, 0, 0);\n            if (tSplat == \"*\")\n            {\n                integer tMP             = llStringLength(tA1);\n                gCorrectAnswer          = llGetSubString(tA1, 1, (tMP-1));\n                tA1                     = gCorrectAnswer;\n            }\n            if (tA1 != \"\")\n            {\n                tAnswerList             += [tA1];\n            }\n            tQA                         = right(tQA, \":\");\n        }\n        llDialog( pActiveId, (\"\\n\"+tQuestion), tAnswerList, dialog_channel2);\n    }\n}\n\n\nstring left(string src, string divider) {\n    integer index                       = llSubStringIndex( src, divider );\n    if(~index)\n    {\n        return llDeleteSubString( src, index + llStringLength(divider)-1, -1);\n    }\n    return src;\n}\n\nstring right(string src, string divider) {\n    integer index                       = llSubStringIndex( src, divider );\n    string tString                      = \"\";\n    if (~index)\n    {\n        return llDeleteSubString( src, 0, index + llStringLength(divider) - 1);\n    }\n    return tString;\n}\n\ninitialize(string _action) {\n    if (_action == \"\") {\n        loadNoteCard(gsCardOneName);\n    } else if (_action == \"finish\") {\n        gQueryCount                 = ((llGetListLength(gOneCard)) - 7);\n        integer i;\n        for (i = 0; i< 7; ++i)\n        {\n            string tLineText        = llList2String(gOneCard,i);\n            if (i == 0)\n            {\n                gMessage            = right(tLineText,\":\");\n            }\n            if (i == 1)\n            {\n                gSuccess            = right(tLineText,\":\");\n                gSuccessInt         = (integer)gSuccess;\n            }\n            if (i == 2)\n            {\n                gFailure            = right(tLineText,\":\");\n            }\n            if (i == 3)\n            {\n                gMinPerc            = ((integer)(right(tLineText,\":\")));\n            }\n            if (i == 4)\n            {\n                pEmail              = right(tLineText,\":\");    \n            }\n            if (i == 5)\n            {\n                dialog_channel2     = ((integer)(right(tLineText,\":\")));\n                //llSay(0, (string)dialog_channel2);\n            }\n            if (i == 6)\n            {\n                reset_channel       = ((integer)(right(tLineText,\":\")));   \n            }\n                llSleep(1);\n                integer tRan = random_integer(4099, 4999);\n                dialog_channel2 = tRan;\n                llListenRemove(pL1);\n                pL1 = llListen(dialog_channel2,\"\", \"\",\"\");\n                pL2 = llListen(reset_channel, \"\", \"\", \"\"); // RESET channel\n        \n        }\n    }\n}\n\nloadNoteCard( string _notecard ) {\n    g_lTempLines                    = [];\n    g_sNoteCardName                 = _notecard;\n    g_iLine                         = 0;\n    g_kQuery                        = llGetNotecardLine(g_sNoteCardName, g_iLine);\n\n}\n\nnotecardFinished(string _notecard){\n    if (_notecard == gsCardOneName) {\n        gOneCard                 = g_lTempLines;\n        initialize(\"finish\");\n    }\n}\n\ndefault\n{\n    state_entry()\n    {\n        llSleep(1);\n        initialize(\"\");\n        qName                   = llGetObjectName();\n    }\n\n    on_rez(integer start_param)\n    {\n        llSleep(1);\n        initialize(\"\");\n        //llSleep(1);\n    }\n\n    touch_start(integer total_number)\n    {\n        pTotal_number               = total_number;\n        list insertNameList         = [(string)pLastId];\n        list tTest                  = [(string)pLastId];\n        integer foundIndex          = llListFindList(pAwardsList, tTest);\n        pLastId = llDetectedKey(0);\n        if (foundIndex != -1)\n            {\n                pActiveQuestion = 0;\n                gScore          = 0;\n                pActiveId = pLastId;\n                llInstantMessage(llDetectedKey(0), \"You have already earned this prize. You may play again, but will not be awarded another prize.\");\n                getNextQuestion();\n            }else{\n\n                pActiveId               = pLastId;\n                pActiveQuestion         = 0;\n                gScore                  = 0;\n                llInstantMessage(pActiveId, gMessage);\n                getNextQuestion();\n            }\n    }\n\n\n    listen(integer cNum, string name, key id, string mes)\n    {\n        if (cNum == reset_channel)\n        {\n            llSay(0, \"resetting user access list\");\n            pAccessList                 = [];\n            pAwardsList                 = [];\n            initialize(\"\");\n        }\n             \n        //llSay(0, (string)cNum + \" \" + name + \" \" + (string) id + \" \" + mes);\n        if (cNum == dialog_channel2) // this is a dialog response\n        {\n            // add a parse for id here to verify that we got the message from the active player\n            //llSay(0, mes);\n            if (id == pActiveId)\n            {\n            // first parse for the correct answer\n                string tttCorrectAnswer = gCorrectAnswer;\n                if (tttCorrectAnswer == mes)\n                    // if they got the answer right\n                {\n                    float tPoints             = (100.0/gQueryCount);\n                    gScore                      = gScore + tPoints;\n                    integer ttPoints = llRound(gScore);\n                    llInstantMessage(pActiveId, \"That's correct! You earned \"+((string)tPoints) + \".  You now have \"+ (string)ttPoints + \" points.\");\n                // inform the player that they got the answer right\n                }else{\n                    llInstantMessage(pActiveId, \"Sorry, that answer is incorrect.\");\n                    // note we could add optional corrective hinting here\n                }\n            }\n            // this chunk advances us to the next sequential question\n            ++pActiveQuestion;\n            if (pActiveQuestion < gQueryCount)\n            {\n                getNextQuestion();\n            }else{\n                if (gScore >= gMinPerc)\n                {\n                    llSetTimerEvent(0.0);\n                    list insertNameList = [(string)pLastId];\n                    list tTest          = [(string)pLastId];\n                    integer foundIndex = llListFindList(pAwardsList, tTest);\n                    if (foundIndex == -1)\n                    {\n                        pAwardsList = llListInsertList(pAwardsList, insertNameList, 0);\n                        llInstantMessage(pActiveId, gSuccess);\n                        llSay(1791, (string)pActiveId); \n                        pActiveQuestion = 0;\n                        vector myPos = llGetPos();\n                        vector relativePosOffset = <0.0,0.0,0.5>;\n                        rotation myRot = llGetRot();\n                        rotation relativeRot = <0.0,0.0,0.0,0.0>;\n                        vector rezPos = myPos+relativePosOffset*myRot;\n                        rotation rezRot = relativeRot*myRot;\n                        //-------------------------------------\n                        integer i = 0;\n                        for (i=0;i < pTotal_number;i++)\n                        {\n                            integer invCount = llGetListLength(types);\n                            integer itemIter;\n                            integer thisTypeIter;\n                            integer type;\n                            integer thisTypeCount;\n                            string scriptName = llGetScriptName();\n                            string itemName;\n                            string tMessage = name + \" completed GAME CHALLENGE \" + qName + \" and earned \" + (string)llRound(gScore) + \" points.\";\n                            \n                            for (itemIter=0; itemIter<invCount;itemIter++)\n                            {\n                                type = llList2Integer(types,itemIter);\n                                thisTypeCount = llGetInventoryNumber(type);\n                                if (thisTypeCount > 0)\n                                {\n                                    for (thisTypeIter=0; thisTypeIter<thisTypeCount;thisTypeIter++)\n                                    {\n                                        itemName = llGetInventoryName(type,thisTypeIter);\n                                        if (scriptName != itemName)\n                                        {\n                                            //llSay(0, (string)type);\n                                            llGiveInventory(pActiveId,itemName);\n                                            if (type == 6)\n                                            {\n                                            llRezObject(itemName, rezPos, <0.0,0.0,0.0>, rezRot, 1);\n}\n                                        }\n                                    }\n                                }\n                            }\n                            llEmail(pEmail, \"SecondLife GAME KIT CHALLENGE Score Report for \"+name, tMessage);\n                        }\n                        pAccessList = [];\n                        pAwardsList = [];\n                    }\n                }else{\n                    llSetTimerEvent(0.0);\n                    llInstantMessage(pActiveId, gFailure);\n                    pActiveQuestion         = 0;\n                    gSuccessInt             = 0;\n                    gScore                  = 0;\n                    string userId           = ((string)pLastId);\n                    pAccessList             = ListItemDelete(pAccessList, userId);\n                    pAccessList             = [];\n                    pAwardsList             = [];\n                }\n            }\n        }\n\n    }\n    dataserver(key _query_id, string _data)\n    {\n        if (_query_id == g_kQuery) {\n            if (_data != EOF) {\n                g_lTempLines += [_data];\n                g_iLine++;\n                g_kQuery = llGetNotecardLine(g_sNoteCardName, g_iLine);\n            } else {\n                    notecardFinished(g_sNoteCardName);\n            }\n        }\n    }\n}",
  "creator": {
    "name": "",
    "uuid": "",
    "grid": ""
  },
  "permissions": {},
  "object_name": ""
}