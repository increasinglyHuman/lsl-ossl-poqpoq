{
  "type": "script",
  "uuid": "19402100-1859-48d1-87c5-056e578211b9",
  "name": "19402100-1859-48d1-87c5-056e578211b9_script",
  "description": "",
  "source": "//----------------------------------------------------------------------------------------//\ninteger llListenHandler;\nstring  tName;\nstring  gsCardOneName = \"config\";\nlist    gOneCard;\nstring  tWho = \"\";\nstring  tGreeting = \"\";\nstring  tComplete = \"\";\nlist    g_lTempLines;\nstring  g_sNoteCardName;\ninteger g_iLine;\nstring  g_kQuery;\ninteger listen_handle;\ninteger listen_handle2;\ninteger tMinPrizes = 0; // set this to the number of prizes u want to require for a victory\ninteger tMinTokens = 0;\nstring  tWinMessage = \"You've mastered the game. Great job!\";\nstring  tIncMessage = \"You haven't gathered enough prizes yet.\";\nstring  url = \"http://www.p0qp0q.com/cgibin/mcfeeny/mcfeenyGameFinal.php\";\nkey     pOwner;\nstring put_id;\n\n// This puts the data to the database (SAVE)\nPutData(string boo2, string who, string msg)\n{\n    string args;\n    args += \"?key=\";\n    boo2 = llEscapeURL(boo2);\n    args += boo2;\n    args +=\"&email=\"+who+\"&message=\";\n    msg = llEscapeURL(msg);\n    args += msg;\n    args += \"&secret=M4g1C14N\";\n    put_id = llHTTPRequest(url+args,[HTTP_METHOD,\"GET\",HTTP_MIMETYPE,\"application/x-www-form-urlencoded\"],\"\");\n}\n\nstring left(string src, string divider) {\n    integer index                       = llSubStringIndex( src, divider );\n    if(~index)\n    {\n        return llDeleteSubString( src, index + llStringLength(divider)-1, -1);\n    }\n    return src;\n}\n\nstring right(string src, string divider) {\n    integer index                       = llSubStringIndex( src, divider );\n    string tString                      = \"\";\n    if (~index)\n    {\n        return llDeleteSubString( src, 0, index + llStringLength(divider) - 1);\n    }\n    return tString;\n}\n\ninitialize(string _action) {\n    if (_action == \"\") {\n        loadNoteCard(gsCardOneName);\n    } else if (_action == \"finish\") {\n        integer i;\n        for (i = 0; i< 7; ++i)\n        {\n            string tLineText        = llList2String(gOneCard,i);\n            if (i == 0)\n            {\n                tWho                = right(tLineText,\":\");\n                if (tWho             == \"yourEmail@yourDomain.com\"); \n                {\n                    llSay(0, \"You'll need to change the email in the config notecard in the contents tab of the editor while the mailbox is selected. After you modify the config notecard, derez (take) the score reporter and then rerez the score reporter\"); \n                }\n            }\n            if (i == 1)\n            {\n                tGreeting           = right(tLineText,\":\");\n            }\n            if (i == 2)\n            {\n                tMinPrizes          = (integer)right(tLineText,\":\");    \n            }\n            if (i == 3)\n            {\n                tMinTokens          = (integer)right(tLineText,\":\");    \n            }\n            if (i == 4)\n            {\n                tWinMessage          = right(tLineText,\":\"); \n            }\n            if (i == 5)\n            {\n                tIncMessage          = right(tLineText,\":\"); \n            }\n        }\n    }\n}\n\nloadNoteCard( string _notecard ) {\n    g_lTempLines                    = [];\n    g_sNoteCardName                 = _notecard;\n    g_iLine                         = 0;\n    g_kQuery                        = llGetNotecardLine(g_sNoteCardName, g_iLine);\n}\n\nnotecardFinished(string _notecard){\n    if (_notecard == gsCardOneName) {\n        gOneCard                 = g_lTempLines;\n        initialize(\"finish\");\n    }\n}\n\n\ndefault\n{\n    state_entry()\n    {\n        listen_handle = llListen(1617, \"\", NULL_KEY, \"\");\n        initialize(\"\");\n    }\n        touch_start(integer num_detected)\n    {\n        if (llDetectedKey(0) == llGetOwner())\n        {\n              initialize(\"\");\n        }\n        llSay(1616, \"ReportScore:board\");\n    }\n    listen( integer channel, string name, key id, string message )\n    {\n        key pId = llGetOwnerKey(id);\n        string peanut = llKey2Name(pId );\n        string tokens = left(message, \":\");\n        string prizes = right(message, \":\");\n        integer tScore = (integer)tokens * (integer)prizes;\n        llInstantMessage(pId, peanut+\" you have collected \"+tokens +\" tokens in the game.\" + \"  You have earned \" + prizes + \" prizes during the game. Your game score is: \" + (string)tScore);\n        if ((integer)prizes >= tMinPrizes)  \n            {\n                //llSay(0, prizes + \" \" + (string)tMinPrizes);\n                //llSay(0, tokens + \" \" + (string)tMinTokens);\n                if ((integer)tokens >= tMinTokens)\n                {\n                llInstantMessage(pId, tWinMessage);\n                }else{\n                    integer tTokenNum = (tMinTokens - ((integer)tokens));\n                    llInstantMessage(pId, (tIncMessage +\" Collect \" + (string)tTokenNum + \" more tokens.\"));\n                }\n            }else{\n                integer tNum = (tMinPrizes-((integer)prizes));\n                llInstantMessage(pId, (tIncMessage +\"Collect \" + (string)tNum + \" more prizes.\"));\n        }\n        pOwner = llGetOwner();\n        string boo = (string)pOwner;\n        string m = (peanut+\" has collected \"+tokens +\" tokens in your game \" + tGreeting + \".  They have earned \" + prizes + \" prizes during the game. Their game score is: \" + (string)tScore);\n        PutData(boo, tWho, m);\n    }\n            dataserver(key _query_id, string _data)\n    {\n        if (_query_id == g_kQuery) {\n            if (_data != EOF) {\n                g_lTempLines += [_data];\n                g_iLine++;\n                g_kQuery = llGetNotecardLine(g_sNoteCardName, g_iLine);\n            } else {\n                    notecardFinished(g_sNoteCardName);\n            }\n        }\n    }\n    \n}",
  "creator": {
    "name": "",
    "uuid": "",
    "grid": ""
  },
  "permissions": {},
  "object_name": ""
}