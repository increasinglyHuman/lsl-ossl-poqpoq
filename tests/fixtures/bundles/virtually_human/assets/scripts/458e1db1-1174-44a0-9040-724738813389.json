{
  "type": "script",
  "uuid": "458e1db1-1174-44a0-9040-724738813389",
  "name": "vh_NPC_116",
  "description": "2013-07-05 14:12:21 lsl2 script",
  "source": "integer debug = FALSE;//whether to chat extra stuff to the owner (look for if(debug) ... statements to see what is chatted)\ninteger dialog_channel2;\ninteger pL1;\ninteger pL2;\ninteger pFlag = 0;\n\nstring firstName = \"Bahiti\";//npc first name, change as you wish\nstring lastName = \"Ata\";//npc last name, change as you wish\n\n\nstring appearanceCard = \"npc_appearance\";//name of the card that is used to create the npc appearance\nstring curActionCard = \"actionCard\";//name of action card\n\nvector npcHomePos;//automatically set, first GOTO vector in curActionCard\nvector npcPos;//automatically set, npc position\nrotation npcRot;//automatically set, npc position\n\n//key pLastAviSeen;\nkey npcKey;//automatically set, npc UUID\nkey ownerKey;//automatically set, prim owner UUID\nkey thisObjectKey;//automatically set, npc rezzer object key\nkey toucher;\n\nlist tGreetsList;\nlist keys;\nlist rezzedObjectKeys;//keys of rezzed objects, get saved to objectsARERezzed card\nlist rezzedObjectPos;//populated from objects2rez card\ninteger lastActionComplete;//frequently updated variable, identifies last action completed (card line # in curActionCard), -1 starting from scratch \ninteger curAction;//next action to perform \nstring curActionCmd;//next action command to perform\nstring curActionValue;//value for next action command (such as a vector for GOTO)\ninteger totalActionCnt;//total number of actions in curActionCard - 1\ninteger i; \n\nosWarpPos(key id, vector destpos ) \n {   \n     vector primPos = llList2Vector(osGetPrimitiveParams(id, [PRIM_POSITION]), 0);\n     integer jumps = (integer)(llVecDist(destpos, primPos) / 10.0) + 1;\n     // Try and avoid stack/heap collisions\n     if (jumps > 411)\n         jumps = 411;\n     list rules = [ PRIM_POSITION, destpos ];  //The start for the rules list\n     integer count = 1;\n     while ( ( count = count << 1 ) < jumps)\n         rules = [] + rules + rules;   //should tighten memory use.\n     osSetPrimitiveParams(id, rules + llList2List( rules, (count - jumps) << 1, count) );\n     vector primPos2 = llList2Vector(osGetPrimitiveParams(id, [PRIM_POSITION]), 0);\n     if ( llVecDist( primPos2, destpos ) > .001 ) //Failsafe\n         while ( --jumps ) \n            osSetPrimitiveParams(id, [PRIM_POSITION, destpos]);\n }\nremoveNpc(key toucher, key npcToRemove) {\n    if(toucher == ownerKey) {\n        osNpcSay(npcToRemove, \"Despawned\");\n        osNpcRemove(npcToRemove);\n        npcKey = NULL_KEY;\n        //llResetScript();\n    }\n}\ncreateNpc(key ownerKey) {\n    //llSleep(2.0);\n    if(llStringLength(osGetNotecard(appearanceCard)) < 15) {\n        osAgentSaveAppearance(ownerKey, appearanceCard);\n    }\n    //llSleep(2.0);\n    //llInstantMessage(ownerKey, (string)npcHomePos);\n    npcKey = osNpcCreate(firstName, lastName, npcHomePos, appearanceCard);\n    npcRot = llGetRot();\n    osNpcSetRot(npcKey, npcRot);\n    setListenChannel();\n    llSleep(2.0);    \n}\ninteger setListenChannel()\n{\n    integer tRanChannel = random_integer(99, 999);\n    dialog_channel2 = tRanChannel;\n    llListenRemove(pL1);\n    llListenRemove(pL2);\n    pL1 = llListen(dialog_channel2,\"\", \"\",\"\");\n    pL2 = llListen(0, \"\", \"\", \"\");\n    return pL1;\n}\ninteger checkForCard(string cardName) {\n    integer numNoteCards = llGetInventoryNumber(INVENTORY_NOTECARD);\n    integer i;\n    integer cardExists = 0;\n    for(i=0;i<numNoteCards;i++) {\n        if(llGetInventoryName(INVENTORY_NOTECARD, i) == cardName) {\n            cardExists = 1;\n        }\n    }\n    return cardExists;       \n}\nsetTotalActions() {\n    totalActionCnt = osGetNumberOfNotecardLines(curActionCard) - 1;\n    if(debug) {llOwnerSay(\"totalActionCnt = \" + (string)totalActionCnt);}\n}\nupdateLastAction() {\n    if(lastActionComplete == -1) {\n        lastActionComplete = 0;\n    }\n    else if (lastActionComplete == totalActionCnt) {\n        lastActionComplete = 0;\n    }\n    else if(lastActionComplete >= 0 && lastActionComplete < totalActionCnt){\n        lastActionComplete = lastActionComplete + 1;\n    }\n    if(debug) {llOwnerSay(\"lastActionComplete = \" + (string)lastActionComplete);}\n}\ngetNextAction() {\n    if(lastActionComplete == -1 || lastActionComplete == totalActionCnt) {\n        curAction = 0;\n    }\n    else {\n        curAction = lastActionComplete + 1;\n    }\n    if(debug) {llOwnerSay(\"curAction = \" + (string)curAction);}\n    list action = llParseString2List(osGetNotecardLine(curActionCard, curAction), [\"===\"], [\"\"]);\n    curActionCmd = llList2String(action, 0);\n    curActionValue = llList2String(action, 1);\n    }\nsetHome() \n    {\n    list action = llParseString2List(osGetNotecardLine(curActionCard, 0), [\"===\"], [\"\"]);\n    npcHomePos = llList2Vector(action, 1);\n    }\nmoveNpc(key npcKey, vector position) {\n    if (position.x > 1){                                   \n        osNpcSetRot(npcKey, llRotBetween(<PI,PI,0>,llVecNorm(position - osNpcGetPos(npcKey))));\n        osNpcMoveToTarget(npcKey, position, OS_NPC_NO_FLY);\n        integer i;   \n        while (llFabs(llVecDist(position, npcPos)) > 2 && i <170){\n            npcPos = osNpcGetPos(npcKey);\n            i++;\n            llSleep(0.1);\n        }\n        if(llFabs(llVecDist(position, npcPos)) > 1) {\n            moveNpc(npcKey, position); \n        }                    \n    }\n    llSetTimerEvent(0.1);\n}\ninteger random_integer( integer min, integer max )\n{\n  return min + (integer)( llFrand( max - min + 1 ) );\n}\ninitSystems()\n{\n    lastActionComplete = -1;//starts fresh\n    setHome();\n    setTotalActions(); \n    pFlag = 0;\n    keys = [];\n    tGreetsList = [\"hello\", \"hi\", \"howdy\", \"halo\",\"hey\", \"sup\", \"yo\", \"hiya\", \"howdy\", \"hullo\"];\n    setListenChannel();\n    llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n    ownerKey = llGetOwner();\n    thisObjectKey = llGetKey();\n    llSetTimerEvent(3);\n}\ninitTouched(key myKey)\n{\n    if(myKey == ownerKey) \n    { \n        lastActionComplete = -1;//starts fresh\n        setHome();\n        setTotalActions();     \n        llSetTimerEvent(5.0);  \n    }\n}\n\nvhSubTimer()\n{\n    llSetTimerEvent(0);\n    setHome();\n    //llInstantMessage(ownerKey, \"Timer triggered, creating NPC\");\n    createNpc(ownerKey);  \n    //llInstantMessage(ownerKey, \"NPC created, setting STATE to idle\");\n    state NPCidle; \n}\nvhSubChanged(integer maskInt)\n{    \n    llSay(0,\"Something Changed \" + (string)maskInt);\n    if(maskInt & CHANGED_OWNER)\n    {\n        llResetScript();\n    }\n    if(maskInt & CHANGED_REGION_START) {\n        do { \n            llSay(0,\"Reseting...\"); \n            llResetScript(); \n            } \n        while (TRUE);\n        llSay(0, \"spawning \" + firstName + \" \" + lastName);\n        createNpc(ownerKey);\n        state NPCidle;\n    }\n}   \nvhSubSensor(integer num2)\n{\n    if (pFlag == 0)\n    {\n        keys = []; \n        integer i = 0;\n        for(i; i < num2; i++)\n            {   \n                key tAviKey = llDetectedKey(i);\n                if (tAviKey != npcKey)\n                { \n                        pFlag = 1;\n                        string avi = llGetDisplayName(llDetectedKey(i));\n                        integer ranIndex13 = random_integer(0, 9);\n                        string tRanReply2 = llList2String(tGreetsList, ranIndex13);\n                        osNpcSay(npcKey, (tRanReply2 + \" \" + avi));\n                    //}\n                }else{\n                    //;\n                }\n            }   \n    }\n}   \nvhSubListen(integer channel1, string name1, key id1, string message1)\n{\n        list test1;\n        string tMes = llToLower(message1);\n        test1 = [tMes];\n        integer tListPos1 = llListFindList(tGreetsList, test1);\n        if (tListPos1 > 0)\n        {\n            list tReplyList = [\"Greetings Citizen\",\"Blessed Day Visitor\",\"Welcome to the city of Posiedon\",\"Filthy Pig, how dare you speak to me.\",\"Hello kind sir\",\"Hello\",\"Good day to you stranger\"]; \n         integer GreetsListLength = llGetListLength(tReplyList);\n         GreetsListLength -=1;\n         integer ranIndex2 = random_integer(0, GreetsListLength);\n         string tRanReply = llList2String(tReplyList, ranIndex2);\n            osNpcSay(npcKey, tRanReply);\n        }\n        if (channel1 == dialog_channel2) \n        {\n           //popMyDialog \n        } \n}           \ndefault\n{\n    state_entry()\n    {\n        initSystems();\n    }//end state entry\n    touch_start(integer number)\n    {\n        key tKey2 = llDetectedKey(0);\n        initTouched(tKey2);              \n    }//end touch start\n    timer() \n    {\n        vhSubTimer();\n    }\n    on_rez(integer param)\n    {   \n        llResetScript();\n        \n    }//end on rez\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    }\n    sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        pFlag = 0;\n        keys = [];   \n    }   \n}\nstate NPCidle // cycleScript state\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensor(\"\", \"\", AGENT | NPC, 6.0, PI);\n        llSetTimerEvent(0);//kill any existing timers\n        if(debug){llOwnerSay(\"NPCidle\");}//Set debug=FALSE to turn off these messages\n        getNextAction();\n        llSetTimerEvent(0.001);//trigger timer event to decide what state to transition to                 \n    }//end state entry\n    timer() {\n        if(curActionCmd == \"GOTO\") {//curActionCmd comes from the action card\n            if(debug){llOwnerSay(\"NPCidle-tmer-goto\");}\n            state NPCgoto;//GOTO command triggers transition to NPCgoto state\n        }\n        else if(curActionCmd == \"PAUSE\") {\n             if(debug){llOwnerSay(\"NPCidle-tmer-pause\");}\n            state NPCpause;\n        }\n        else if(curActionCmd == \"ANIMATE\") {\n             if(debug){llOwnerSay(\"NPCidle-tmer-animate\");}\n            state NPCanimate;\n        }\n        else if(curActionCmd == \"STOPANIMATE\") {\n             if(debug){llOwnerSay(\"NPCidle-tmer-deanimate\");}\n            state NPCdeanimate;\n        }\n        else if(curActionCmd == \"TALK\") {\n             if(debug){llOwnerSay(\"NPCidle-tmer-talk\");}\n            state NPCtalk;\n        }\n        else if(curActionCmd == \"RANDOMTALK\") {\n             if(debug){llOwnerSay(\"NPCidle-tmer-talk\");}\n            state NPCrandomtalk;\n        }\n        else if(curActionCmd == \"SIT\") {\n             if(debug){llOwnerSay(\"NPCidle-tmer-sit\");}\n            state NPCsit;\n        }\n        else if(curActionCmd == \"STAND\") {\n             if(debug){llOwnerSay(\"NPCidle-tmer-stand\");}\n            state NPCstand;\n        }\n        else {\n            if(debug){llOwnerSay(\"NPCidle-tmer-command UNKNOWN. \" + curActionCmd + \" \" + curActionValue + \". Going to next action\");}\n            updateLastAction();\n        } \n    }\n    touch_end(integer number)\n    {\n        //IMPORTANT: if using touch to trigger state change, use touch_end NOT touch_start, as done here\n        removeNpc(llDetectedKey(0), npcKey);\n        state default;\n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    } \n        sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        pFlag = 0;\n        keys = [];   \n    }  \n}\nstate NPCtalk\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n        //llSensor(\"\", \"\", AGENT | NPC, 6.0, PI);\n        llSetTimerEvent(0); // kill the timer\n        if(debug){llOwnerSay(\"NPCtalk\");} // ID the state in DEBUG MODE\n        string npcChat = curActionValue; // string taken from the line on the notecard\n        if(debug) {llOwnerSay(\"commanded to chat \"); } // DEBUG line\n        osNpcSay(npcKey, npcChat); // Say it\n        llSetTimerEvent(0.001); // Start the timer\n    }\n    timer()\n    {\n        updateLastAction(); // Move to the next notecard line\n        state NPCidle;      // Change the state to IDLE\n    }\n    touch_end(integer number)\n    {\n        removeNpc(llDetectedKey(0), npcKey); // If you touch it, kill it\n        state default;\n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    } \n        sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        \n        pFlag = 0;\n        keys = [];   \n    }  \n}\nstate NPCrandomtalk\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n        //llSensor(\"\", \"\", AGENT | NPC, 6.0, PI);\n        llSetTimerEvent(0); // kill the timer\n        if(debug){llOwnerSay(\"NPCrandomtalk\");} // ID the state in DEBUG MODE\n        string npcRandomchat = curActionValue; // string taken from the line on the notecard\n        if(debug) {llOwnerSay(\"commanded to chat \"); } // DEBUG line\n         list NPCrcList = llCSV2List(npcRandomchat);\n         integer NPCrcListLength = llGetListLength(NPCrcList);\n         NPCrcListLength -=1;\n         integer ranIndex = random_integer(0, NPCrcListLength);\n         string randomchat = llList2String(NPCrcList, ranIndex);\n        osNpcSay(npcKey, randomchat); // Say it\n        llSetTimerEvent(0.001); // Start the timer\n    }\n    timer()\n    {\n        updateLastAction(); // Move to the next notecard line\n        state NPCidle;      // Change the state to IDLE\n    }\n    touch_end(integer number)\n    {\n        removeNpc(llDetectedKey(0), npcKey); // If you touch it, kill it\n        state default;\n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    }\n        sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        \n        pFlag = 0;\n        keys = [];   \n    }   \n}\n\nstate NPCanimate\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n        //llSensor(\"\", \"\", AGENT | NPC, 6.0, PI);\n        llSetTimerEvent(0);\n        if(debug){llOwnerSay(\"NPCanimate\");}\n        string npcAnim = curActionValue;\n        if(debug) {llOwnerSay(\"playing \" + npcAnim + \" animation\"); }\n        osNpcPlayAnimation(npcKey, npcAnim);\n        llSetTimerEvent(0.001);\n    }\n    timer()\n    {\n        updateLastAction();\n        state NPCidle;\n    }\n    touch_end(integer number)\n    {\n        removeNpc(llDetectedKey(0), npcKey);\n        state default;\n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    } \n        sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        \n        pFlag = 0;\n        keys = [];   \n    }  \n}\nstate NPCdeanimate\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n        //llSensor(\"\", \"\", AGENT | NPC, 6.0, PI);\n        llSetTimerEvent(0);\n        if(debug){llOwnerSay(\"NPCdeanimate\");}\n        string npcAnim = curActionValue;\n        if(debug) {llOwnerSay(\"playing \" + npcAnim + \" animation\"); }\n        osNpcStopAnimation(npcKey, npcAnim);\n        llSetTimerEvent(0.001);\n    }\n    timer()\n    {\n        updateLastAction();\n        state NPCidle;\n    }\n    touch_end(integer number)\n    {\n        removeNpc(llDetectedKey(0), npcKey);\n        state default;\n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    } \n    sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        pFlag = 0;\n        keys = [];   \n    }  \n}\n\n\nstate NPCsit\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n        //llSensor(\"\", \"\", AGENT | NPC, 6.0, PI);\n        llSetTimerEvent(0);\n         if(debug){llOwnerSay(\"NPCsit\");}\n        integer npcSeat = (integer)curActionValue;\n        key npcSeatKey = (key)osGetNotecardLine(\"objectsARERezzed\", npcSeat);\n        if(debug) {llOwnerSay(\"commanded to sit on seat \" + (string)npcSeat); }\n        osNpcSit(npcKey, npcSeatKey, OS_NPC_SIT_NOW);\n        llSetTimerEvent(0.001);\n    }\n    timer()\n    {\n        updateLastAction();\n        state NPCidle;\n    }\n    touch_end(integer number)\n    {\n        removeNpc(llDetectedKey(0), npcKey);\n        state default;\n    \n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    }\n        sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        pFlag = 0;\n        keys = [];   \n    }   \n}\nstate NPCstand\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n        //llSensor(\"\", \"\", AGENT | NPC, 6.0, PI);\n        llSetTimerEvent(0);\n        if(debug){llOwnerSay(\"NPCstand\");}\n        if(debug) {llOwnerSay(\"commanded to stand \"); }\n        osNpcStand(npcKey);\n        llSetTimerEvent(0.001);\n    }\n    timer()\n    {\n        updateLastAction();\n        state NPCidle;\n    }\n\n    touch_end(integer number)\n    {\n        removeNpc(llDetectedKey(0), npcKey);\n        state default;\n    \n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    }\n        sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        pFlag = 0;\n        keys = [];   \n    }   \n}\n\nstate NPCpause\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n        //llSensor(\"\", \"\", AGENT | NPC, 6.0, PI);\n        llSetTimerEvent(0);\n        if(debug){llOwnerSay(\"NPCpause\");}\n        float pause = (float)curActionValue;\n        if(debug) {llOwnerSay(\"Pausing \" + (string)pause + \" seconds\"); }\n        llSetTimerEvent(pause);\n    }\n    timer()\n    {\n        updateLastAction();\n        state NPCidle;\n    }\n    touch_end(integer number)\n    {\n        removeNpc(llDetectedKey(0), npcKey);\n        state default;\n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    } \n        sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        pFlag = 0;\n        keys = [];   \n    }  \n}\n\nstate NPCgoto\n{\n    state_entry()\n    {\n        setListenChannel();\n        llSensorRepeat(\"\", \"\", AGENT, 6.0, PI, 0.5);\n        i = 0;\n        llSetTimerEvent(0);\n        if(debug){llOwnerSay(\"NPCgoto\");}\n        npcPos = osNpcGetPos(npcKey);\n        vector position = (vector)curActionValue;\n        if(debug) {llOwnerSay(\"moving to \" + (string)position);}\n        if (position.x > 1)\n        {                              \n            osNpcSetRot(npcKey, llRotBetween(<PI,PI,0>,llVecNorm(position - osNpcGetPos(npcKey))));\n            osNpcMoveToTarget(npcKey, position, OS_NPC_NO_FLY);                 \n        }else{\n                //getNextAction();\n                //updateLastAction();\n                llSay(0, \"boo\");\n                state NPCidle;\n        }\n        llSetTimerEvent(1);\n    }\n    timer()\n        {\n        npcPos = osNpcGetPos(npcKey);\n        vector position = (vector)curActionValue;\n            if(llFabs(llVecDist(position, npcPos)) < 2) \n            {\n                osWarpPos(thisObjectKey, npcPos); \n                updateLastAction();\n                state NPCidle;\n            }\n    }\n    touch_end(integer number)\n    {\n        removeNpc(llDetectedKey(0), npcKey);\n        state default;\n    }//end touch end\n    changed(integer mask)\n    {\n        if(mask & CHANGED_OWNER)\n            {\n                llResetScript();\n            }\n            if(mask & CHANGED_REGION_START) \n            {\n            //llInstantMessage(ownerKey, \"spawning \" + firstName + \" \" + lastName);\n            removeNpc(llDetectedKey(0), npcKey);\n            state default;\n        }\n    }\n    listen(integer channel, string name, key id, string message)\n    {\n        vhSubListen(channel, name, id, message);\n    } \n        sensor(integer num)\n    {   \n        vhSubSensor(num);\n    }   \n    no_sensor()\n    {   \n        pFlag = 0;\n        keys = [];   \n    }  \n}\n",
  "creator": {
    "name": "Allen Partridge",
    "uuid": "fb65c818-b6e2-4367-8f65-a069ff0443bf",
    "grid": "http://grid.kitely.com:8002"
  },
  "permissions": {
    "base": 2147483647,
    "current": 2147483647,
    "next": 532480,
    "everyone": 0,
    "group": 0
  },
  "object_name": "AtlantianSpawner"
}